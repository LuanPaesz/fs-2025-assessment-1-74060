@using DublinBikes.Blazor.Models

<div class="filters-container">
    <div class="mb-2">
        <label for="search" class="form-label">Search (name or address)</label>
        <input id="search" class="form-control"
               @bind="SearchTerm"
               @bind:event="oninput"
               placeholder="Type to filter..." />
    </div>

    <div class="mb-2">
        <label for="status" class="form-label">Status</label>
        <select id="status" class="form-select" @bind="Status">
            <option value="">All</option>
            <option value="OPEN">Open</option>
            <option value="CLOSED">Closed</option>
        </select>
    </div>

    <div class="mb-2">
        <label for="minBikes" class="form-label">Minimum available bikes</label>
        <input id="minBikes" type="number" class="form-control" @bind="MinBikes" />
    </div>

    <button class="btn btn-primary me-2" @onclick="ApplyFilters">Apply</button>
    <button class="btn btn-outline-secondary" @onclick="ClearFilters">Clear</button>
</div>

@code {
    [Parameter] public string? InitialSearchTerm { get; set; }
    [Parameter] public string? InitialStatus { get; set; }
    [Parameter] public int? InitialMinBikes { get; set; }

    [Parameter] public EventCallback<StationQueryParameters> OnFiltersChanged { get; set; }

    private string? SearchTerm { get; set; }
    private string? Status { get; set; }
    private int? MinBikes { get; set; }

    protected override void OnInitialized()
    {
        SearchTerm = InitialSearchTerm;
        Status = InitialStatus;
        MinBikes = InitialMinBikes;
    }

    private async Task ApplyFilters()
    {
        var parameters = new StationQueryParameters
        {
            SearchTerm = SearchTerm,
            Status = Status,
            MinBikes = MinBikes
        };

        await OnFiltersChanged.InvokeAsync(parameters);
    }

    private async Task ClearFilters()
    {
        SearchTerm = null;
        Status = null;
        MinBikes = null;

        await ApplyFilters();
    }
}
